## 设置规则引擎(可选)

在本次实验中，您会发现传感器上传某些时间点数据和和室内温度、空气湿度数据明显不一致，这是因为传感器的一些干扰数据并没有过滤，如果看回到树莓派输出，您会发现树莓派本地输出会把这些错误数据打印出来了，并提醒为wrong。我们充分利用这些错误的数据，在AWS上，使用IoT + 数据分析功能，把这些标识出来，进一步体现数据分析的实用性，重要性。

在前面一节”把树莓派接入到AWS IoT“，我们已经通过topic 把传感器数据发到AWS IoT 平台，现在，我们把这些传感器数据存储到S3 ，以便后续数据分析。

1. 打开AWS IoT 控制台 (https://console.amazonaws.cn/iot/home?region=cn-north-1#/dashboard)
2. 选择左边菜单栏的行动，您将看到规则页面
3. 选择创建规则
4. 名称：raspberry<组号>，描述可以留空不填
5. 属性：*
6. 主题筛选条件："raspberry<组号>/sensor/data"（示例：raspberry01/sensor/data）
7. 选择添加操作，在下一屏幕中选择 "在 Amazon S3 存储桶中存储消息"，然后点击配置操作进入下一步
8. 选择创建新资源会跳到S3控制台页面，然后选择页面中“创建的存储桶”，在页面输入raspberry<组号>作为您唯一的存储桶，之后返回IoT 控制台页面，点击页面中的刷新按钮，选择您刚刚创建的存储桶
9. *键一栏输入：${timestamp()}sensordata
10. IAM 角色选择“创建一个新角色” 
11. 最后确认无误点击右下方添加操作

![rule.png](./images/rule.png)

配置完成之后，稍等片刻即可在您创建的S3存储桶中查看到上传上来的数据。之后您可以充分使用AWS 数据分析服务，并充分使用数据湖进行分析，例如AWS EMR，Elasticsearch，Redshift 等服务进行数据分析。在本实验中不一一展开说明。
